"use strict";(self.webpackChunksoulike_git=self.webpackChunksoulike_git||[]).push([[8515],{48515:function(Le,Q,i){i.r(Q),i.d(Q,{default:function(){return We}});var o=i(89526),$={Conflict:"Style_Conflict__2ma+v",conflictsWrapper:"Style_conflictsWrapper__wfWYJ",conflictWrapper:"Style_conflictWrapper__vrTA4",buttonWrapper:"Style_buttonWrapper__L8uVX"},ce=i(5892),q=i(53546),ie=i(23377),de=i(30592),_=i(57428),S=i(18440),W=i(76320),k={ConflictEditor:"Style_ConflictEditor__v9LSs",header:"Style_header__mjTe2",filePath:"Style_filePath__1ToRJ",checkboxWrapper:"Style_checkboxWrapper__RFUz5",text:"Style_text__VY9D5"},E=i(4942),U=i(87462),fe=i(64403),j=i.n(fe),he=i(45987),T=i(1413),pe=i(15671),ve=i(43144),me=i(60136),Ce=i(54062),ee=function(c){(0,me.Z)(n,c);var r=(0,Ce.Z)(n);function n(e){var t;(0,pe.Z)(this,n),t=r.call(this,e),t.handleChange=function(s){var u=t.props,l=u.disabled,d=u.onChange;l||("checked"in t.props||t.setState({checked:s.target.checked}),d&&d({target:(0,T.Z)((0,T.Z)({},t.props),{},{checked:s.target.checked}),stopPropagation:function(){s.stopPropagation()},preventDefault:function(){s.preventDefault()},nativeEvent:s.nativeEvent}))},t.saveInput=function(s){t.input=s};var a="checked"in e?e.checked:e.defaultChecked;return t.state={checked:a},t}return(0,ve.Z)(n,[{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var t,a=this.props,s=a.prefixCls,u=a.className,l=a.style,d=a.name,h=a.id,p=a.type,x=a.disabled,B=a.readOnly,v=a.tabIndex,O=a.onClick,Z=a.onFocus,b=a.onBlur,f=a.onKeyDown,N=a.onKeyPress,y=a.onKeyUp,g=a.autoFocus,D=a.value,A=a.required,G=(0,he.Z)(a,["prefixCls","className","style","name","id","type","disabled","readOnly","tabIndex","onClick","onFocus","onBlur","onKeyDown","onKeyPress","onKeyUp","autoFocus","value","required"]),X=Object.keys(G).reduce(function(V,R){return(R.substr(0,5)==="aria-"||R.substr(0,5)==="data-"||R==="role")&&(V[R]=G[R]),V},{}),L=this.state.checked,w=j()(s,u,(t={},(0,E.Z)(t,"".concat(s,"-checked"),L),(0,E.Z)(t,"".concat(s,"-disabled"),x),t));return o.createElement("span",{className:w,style:l},o.createElement("input",(0,U.Z)({name:d,id:h,type:p,required:A,readOnly:B,disabled:x,tabIndex:v,className:"".concat(s,"-input"),checked:!!L,onClick:O,onFocus:Z,onBlur:b,onKeyUp:y,onKeyDown:f,onKeyPress:N,onChange:this.handleChange,autoFocus:g,ref:this.saveInput,value:D},X)),o.createElement("span",{className:"".concat(s,"-inner")}))}}],[{key:"getDerivedStateFromProps",value:function(t,a){return"checked"in t?(0,T.Z)((0,T.Z)({},a),{},{checked:t.checked}):null}}]),n}(o.Component);ee.defaultProps={prefixCls:"rc-checkbox",className:"",style:{},type:"checkbox",defaultChecked:!1,onFocus:function(){},onBlur:function(){},onChange:function(){},onKeyDown:function(){},onKeyPress:function(){},onKeyUp:function(){}};var ye=ee,te=i(93433),ne=i(29439),ge=i(78326),oe=i(62432),Ee=function(c,r){var n={};for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&r.indexOf(e)<0&&(n[e]=c[e]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,e=Object.getOwnPropertySymbols(c);t<e.length;t++)r.indexOf(e[t])<0&&Object.prototype.propertyIsEnumerable.call(c,e[t])&&(n[e[t]]=c[e[t]]);return n},ae=o.createContext(null),xe=function(r,n){var e=r.defaultValue,t=r.children,a=r.options,s=a===void 0?[]:a,u=r.prefixCls,l=r.className,d=r.style,h=r.onChange,p=Ee(r,["defaultValue","children","options","prefixCls","className","style","onChange"]),x=o.useContext(oe.E_),B=x.getPrefixCls,v=x.direction,O=o.useState(p.value||e||[]),Z=(0,ne.Z)(O,2),b=Z[0],f=Z[1],N=o.useState([]),y=(0,ne.Z)(N,2),g=y[0],D=y[1];o.useEffect(function(){"value"in p&&f(p.value||[])},[p.value]);var A=function(){return s.map(function(C){return typeof C=="string"||typeof C=="number"?{label:C,value:C}:C})},G=function(C){D(function(I){return I.filter(function(K){return K!==C})})},X=function(C){D(function(I){return[].concat((0,te.Z)(I),[C])})},L=function(C){var I=b.indexOf(C.value),K=(0,te.Z)(b);I===-1?K.push(C.value):K.splice(I,1),"value"in p||f(K);var ue=A();h==null||h(K.filter(function(J){return g.indexOf(J)!==-1}).sort(function(J,Te){var Me=ue.findIndex(function(Y){return Y.value===J}),Ge=ue.findIndex(function(Y){return Y.value===Te});return Me-Ge}))},w=B("checkbox",u),V="".concat(w,"-group"),R=(0,ge.Z)(p,["value","disabled"]);s&&s.length>0&&(t=A().map(function(m){return o.createElement(se,{prefixCls:w,key:m.value.toString(),disabled:"disabled"in m?m.disabled:p.disabled,value:m.value,checked:b.indexOf(m.value)!==-1,onChange:m.onChange,className:"".concat(V,"-item"),style:m.style},m.label)}));var Ue={toggleOption:L,value:b,disabled:p.disabled,name:p.name,registerValue:X,cancelValue:G},je=j()(V,(0,E.Z)({},"".concat(V,"-rtl"),v==="rtl"),l);return o.createElement("div",(0,U.Z)({className:je,style:d},R,{ref:n}),o.createElement(ae.Provider,{value:Ue},t))},be=o.forwardRef(xe),Pe=o.memo(be),Ne=i(98380),Re=function(c,r){var n={};for(var e in c)Object.prototype.hasOwnProperty.call(c,e)&&r.indexOf(e)<0&&(n[e]=c[e]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,e=Object.getOwnPropertySymbols(c);t<e.length;t++)r.indexOf(e[t])<0&&Object.prototype.propertyIsEnumerable.call(c,e[t])&&(n[e[t]]=c[e[t]]);return n},Se=function(r,n){var e,t=r.prefixCls,a=r.className,s=r.children,u=r.indeterminate,l=u===void 0?!1:u,d=r.style,h=r.onMouseEnter,p=r.onMouseLeave,x=r.skipGroup,B=x===void 0?!1:x,v=Re(r,["prefixCls","className","children","indeterminate","style","onMouseEnter","onMouseLeave","skipGroup"]),O=o.useContext(oe.E_),Z=O.getPrefixCls,b=O.direction,f=o.useContext(ae),N=o.useRef(v.value);o.useEffect(function(){f==null||f.registerValue(v.value),(0,Ne.Z)("checked"in v||!!f||!("value"in v),"Checkbox","`value` is not a valid prop, do you mean `checked`?")},[]),o.useEffect(function(){if(!B)return v.value!==N.current&&(f==null||f.cancelValue(N.current),f==null||f.registerValue(v.value),N.current=v.value),function(){return f==null?void 0:f.cancelValue(v.value)}},[v.value]);var y=Z("checkbox",t),g=(0,U.Z)({},v);f&&!B&&(g.onChange=function(){v.onChange&&v.onChange.apply(v,arguments),f.toggleOption&&f.toggleOption({label:s,value:v.value})},g.name=f.name,g.checked=f.value.indexOf(v.value)!==-1,g.disabled=v.disabled||f.disabled);var D=j()((e={},(0,E.Z)(e,"".concat(y,"-wrapper"),!0),(0,E.Z)(e,"".concat(y,"-rtl"),b==="rtl"),(0,E.Z)(e,"".concat(y,"-wrapper-checked"),g.checked),(0,E.Z)(e,"".concat(y,"-wrapper-disabled"),g.disabled),e),a),A=j()((0,E.Z)({},"".concat(y,"-indeterminate"),l));return o.createElement("label",{className:D,style:d,onMouseEnter:h,onMouseLeave:p},o.createElement(ye,(0,U.Z)({},g,{prefixCls:y,className:A,ref:n})),s!==void 0&&o.createElement("span",null,s))},re=o.forwardRef(Se);re.displayName="Checkbox";var se=re,z=se;z.Group=Pe,z.__ANT_CHECKBOX=!0;var ke=z;const Fe=o.lazy(()=>Promise.all([i.e(4143),i.e(3470)]).then(i.bind(i,3470)));function Be(c){const{conflict:{filePath:r},code:n,onCodeChange:e,onResolvedCheckboxChange:t,resolved:a}=c;return o.createElement("div",{className:k.ConflictEditor},o.createElement("div",{className:k.header},o.createElement("code",{className:k.filePath},r),o.createElement("label",{className:k.checkboxWrapper},o.createElement(ke,{onChange:t,checked:a}),o.createElement("div",{className:k.text},"\u5DF2\u89E3\u51B3"))),o.createElement("div",{className:k.codeWrapper,style:a?{position:"fixed",top:"99999999px"}:{}},o.createElement(Fe,{onBeforeChange:e,value:n,options:{lineNumbers:!0,indentUnit:0}})))}var Oe=o.memo(Be),F=i(24315),Ze=(c,r,n)=>new Promise((e,t)=>{var a=l=>{try{u(n.next(l))}catch(d){t(d)}},s=l=>{try{u(n.throw(l))}catch(d){t(d)}},u=l=>l.done?e(l.value):Promise.resolve(l.value).then(a,s);u((n=n.apply(c,r)).next())});class De extends o.PureComponent{constructor(r){super(r);this.onCodeChange=(n,e,t)=>{this.setState({code:t})},this.onResolvedCheckboxChange=n=>{const{code:e}=this.state,{conflict:{filePath:t}}=this.props;e.search(/^<<<<<<< .+$/m)!==-1||e.search(/^=======$/m)!==-1||e.search(/^>>>>>>> .+$/m)!==-1?F.Z.warning({message:o.createElement("div",null,o.createElement("code",null,t)," \u4E2D\u4ECD\u5B58\u5728\u51B2\u7A81"),description:"\u8BF7\u89E3\u51B3\u51B2\u7A81\uFF0C\u5E76\u5220\u9664\u6240\u6709\u7684\u51B2\u7A81\u6807\u8BB0"}):this.setState({resolved:n.target.checked})},this.state={code:"",resolved:!1}}componentDidMount(){const{conflict:{content:r}}=this.props;this.setState({code:r})}componentDidUpdate(r,n,e){return Ze(this,null,function*(){const{conflict:t}=this.props,{conflict:a}=r;t!==a&&(yield this.componentDidMount());const{onChange:s}=this.props;if(typeof s=="function"){const{code:u,resolved:l}=this.state,{filePath:d}=t,{code:h,resolved:p}=n;(u!==h||l!==p)&&(yield s(d,l,u))}})}render(){const{code:r,resolved:n}=this.state,{conflict:e}=this.props;return o.createElement(Oe,{conflict:e,code:r,onCodeChange:this.onCodeChange,resolved:n,onResolvedCheckboxChange:this.onResolvedCheckboxChange})}}var Ae=De;function Ve(c){const{loading:r,pullRequest:{sourceRepositoryUsername:n,sourceRepositoryName:e,sourceRepositoryBranchName:t,targetRepositoryUsername:a,targetRepositoryName:s,targetRepositoryBranchName:u},conflicts:l,onConflictChange:d,onSubmitButtonClick:h}=c;return o.createElement("div",{className:$.Conflict},o.createElement(ce.Z,{spinning:r},o.createElement("div",{className:$.alert},o.createElement(q.Z,{type:"info",banner:!0,showIcon:!0,message:o.createElement("div",null,"\u6B63\u5728\u89E3\u51B3 ",o.createElement(_.Z,{to:S.Function.generateRepositoryCodeRoute({username:n,repositoryName:e,objectType:W.LP.TREE,commitHash:t})},o.createElement("code",null,n,"/",e,":",t))," \u5230 ",o.createElement(_.Z,{to:S.Function.generateRepositoryCodeRoute({username:a,repositoryName:s,objectType:W.LP.TREE,commitHash:u})},o.createElement("code",null,a,"/",s,":",u))," \u7684\u5408\u5E76\u51B2\u7A81")}),o.createElement(q.Z,{type:"warning",banner:!0,showIcon:!0,message:o.createElement("div",null,"\u6240\u505A\u7684\u4FEE\u6539\u5C06\u88AB\u63D0\u4EA4\u5230 ",o.createElement("code",null,n,"/",e,":",t))})),o.createElement("div",{className:$.conflictsWrapper},l.map(p=>o.createElement("div",{key:p.filePath,className:$.conflictWrapper},o.createElement(Ae,{conflict:p,onChange:d})))),o.createElement("div",{className:$.buttonWrapper},o.createElement(ie.Z,{onConfirm:h,disabled:r,title:o.createElement("div",null,"\u786E\u8BA4\u51B2\u7A81\u89E3\u51B3\uFF1F",o.createElement("br",null),o.createElement("strong",null,"\u4EE5\u4E0A\u4FEE\u6539\u90FD\u5C06\u88AB\u63D0\u4EA4\u5230 ",o.createElement("code",null,n,"/",e,":",t)))},o.createElement(de.Z,{type:"primary",size:"large",disabled:r,loading:r},"\u63D0\u4EA4")))))}var Ie=o.memo(Ve),Ke=i(65092),le=i(60269),H=i(62371),M=i(36393),P=(c,r,n)=>new Promise((e,t)=>{var a=l=>{try{u(n.next(l))}catch(d){t(d)}},s=l=>{try{u(n.throw(l))}catch(d){t(d)}},u=l=>l.done?e(l.value):Promise.resolve(l.value).then(a,s);u((n=n.apply(c,r)).next())});class $e extends o.PureComponent{constructor(r){super(r);this.checkURL=()=>{const{match:{params:{no:n}},history:e}=this.props,t=Number.parseInt(n);if(Number.isNaN(t))return e.replace(M.yt[M.DV.NOT_FOUND])},this.loadPullRequest=()=>P(this,null,function*(){return new Promise(n=>P(this,null,function*(){const{match:{params:{username:e,repositoryName:t,no:a}},history:s}=this.props,u=Number.parseInt(a),l=yield H.i7.get({username:e,name:t},{no:u});if(l!==null){const{status:d}=l;if(d!==W.El.OPEN)return F.Z.warn({message:`Pull Request #${u} \u5DF2\u5173\u95ED\u6216\u5408\u5E76`}),n(),s.replace(S.Function.generateRepositoryPullRequestRoute({username:e,repositoryName:t,no:a}));this.setState({pullRequest:l},()=>n())}else return n(),s.replace(M.yt[M.DV.NOT_FOUND])}))}),this.loadConflicts=()=>P(this,null,function*(){return new Promise(n=>P(this,null,function*(){const{pullRequest:e}=this.state,{id:t}=e,a=yield H.i7.getConflicts({id:t});if(a!==null){const{conflicts:s}=a,{match:{params:{username:u,repositoryName:l,no:d}},history:h}=this.props;if(s.length===0)return F.Z.warn({message:`${u}/${l} #${d} \u6CA1\u6709\u5408\u5E76\u51B2\u7A81`,description:"\u60A8\u53EF\u76F4\u63A5\u6267\u884C\u5408\u5E76\u64CD\u4F5C"}),n(),h.replace(S.Function.generateRepositoryPullRequestRoute({username:u,repositoryName:l,no:d}));s.forEach(({isBinary:p})=>{if(p)return F.Z.warn({message:"\u5B58\u5728\u4E8C\u8FDB\u5236\u6587\u4EF6\u51B2\u7A81",description:"\u8BF7\u4F7F\u7528\u547D\u4EE4\u884C\u89E3\u51B3\u51B2\u7A81"}),n(),h.replace(S.Function.generateRepositoryPullRequestRoute({username:u,repositoryName:l,no:d}))}),this.setState({conflicts:s},()=>n())}else n()}))}),this.onConflictChange=(n,e,t)=>{const{conflicts:a,resolvedFilePath:s}=this.state;for(let u=0;u<a.length;u++){const{filePath:l,isBinary:d,content:h}=a[u];l===n&&t!==h&&(a[u]=new le.sX(n,d,t)),e?s.add(n):s.delete(n)}},this.onSubmitButtonClick=()=>P(this,null,function*(){const{pullRequest:{id:n},resolvedFilePath:e,conflicts:t}=this.state;if(t.map(({filePath:s})=>s).length!==e.size)F.Z.error({message:"\u8BF7\u89E3\u51B3\u6240\u6709\u51B2\u7A81\u540E\u518D\u63D0\u4EA4"});else{if(this.setState({loading:!0}),(yield H.i7.resolveConflicts({id:n},t))!==null){F.Z.success({message:"\u89E3\u51B3\u51B2\u7A81\u6210\u529F"});const{history:u,match:{params:{username:l,repositoryName:d,no:h}}}=this.props;return u.push(S.Function.generateRepositoryPullRequestRoute({username:l,repositoryName:d,no:h}))}this.setState({loading:!1})}}),this.state={pullRequest:new le.i7(0,0,"","","","","","","","",0,0,"","",W.El.CLOSED),conflicts:[],loading:!1,resolvedFilePath:new Set}}componentDidMount(){return P(this,null,function*(){this.checkURL(),this.setState({loading:!0}),yield this.loadPullRequest(),this.setState({loading:!1})})}componentDidUpdate(r,n,e){return P(this,null,function*(){const{location:{pathname:t}}=this.props,{location:{pathname:a}}=this.props;t!==a&&(yield this.componentDidMount());const{pullRequest:{id:s}}=this.state,{pullRequest:{id:u}}=n;u!==s&&(this.setState({loading:!0}),yield this.loadConflicts(),this.setState({loading:!1}))})}render(){const{loading:r,pullRequest:n,conflicts:e}=this.state;return o.createElement(Ie,{loading:r,pullRequest:n,conflicts:e,onConflictChange:this.onConflictChange,onSubmitButtonClick:this.onSubmitButtonClick})}}var We=(0,Ke.EN)($e)}}]);

//# sourceMappingURL=8515.09b89ef6.chunk.js.map