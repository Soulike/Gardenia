(this["webpackJsonpsoulike-git"]=this["webpackJsonpsoulike-git"]||[]).push([[39],{1103:function(y,C,a){y.exports={Members:"Style_Members__1A1TA",topArea:"Style_topArea__2Rqcb",cardContent:"Style_cardContent__3XM0M",titleWrapper:"Style_titleWrapper__30lrm",name:"Style_name__35BXt",isAdminTagWrapper:"Style_isAdminTagWrapper__h56El",isAdminTag:"Style_isAdminTag__3vPt2",avatarWrapper:"Style_avatarWrapper__31DG6",avatar:"Style_avatar__39V_0"}},1104:function(y,C,a){y.exports={modalContent:"Style_modalContent__2QoB9",usernameInput:"Style_usernameInput__2TSrf"}},1395:function(y,C,a){"use strict";a.r(C),a.d(C,"default",function(){return ee});var v={};a.r(v),a.d(v,"addMember",function(){return K});var M=a(0),n=a.n(M),D=a(1103),p=a.n(D),W=a(962),O=a(1423),R=a(177),T=a(959),U=a(963),j=a(964),g=a(951),E=a(101),V=a(48),$=a(271),x=a(955),L=a(954),z=a(498),J=a(1104),B=a.n(J);function X(m){const{onClick:r,showModal:e,username:t,loading:s,onModalCancelClick:o,onModalOkClick:c,onUsernameChange:d}=m;return n.a.createElement(n.a.Fragment,null,n.a.createElement(E.a,{type:"primary",onClick:r,loading:s,disabled:s},n.a.createElement(z.a,null),"\u6DFB\u52A0\u6210\u5458"),n.a.createElement(x.a,{destroyOnClose:!0,width:300,title:"\u6DFB\u52A0\u5C0F\u7EC4\u6210\u5458",visible:e,onOk:c,onCancel:o,confirmLoading:s},n.a.createElement("div",{className:B.a.modalContent},n.a.createElement(L.a,{value:t,onChange:d,autoFocus:!0,placeholder:"\u65B0\u5C0F\u7EC4\u6210\u5458\u7684\u7528\u6237\u540D",className:B.a.usernameInput}))))}var G=n.a.memo(X),F=a(96),b=a(46),f=a(27),Q=a(146),A=a(339),H=a(133),P=new H.EventEmitter;const K="addMember";var N,ne=typeof N!="undefined"?N:m=>{throw new Error('Dynamic require of "'+m+'" is not supported')},S=(m,r,e)=>new Promise((t,s)=>{var o=i=>{try{d(e.next(i))}catch(l){s(l)}},c=i=>{try{d(e.throw(i))}catch(l){s(l)}},d=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,c);d((e=e.apply(m,r)).next())});class Y extends M.PureComponent{constructor(r){super(r);this.setStatePromise=Object(F.promisify)(this.setState),this.initModal=()=>S(this,null,function*(){this.setStatePromise({username:""})}),this.onClick=()=>S(this,null,function*(){yield this.setStatePromise({showModal:!0}),yield this.initModal()}),this.onModalOkClick=()=>S(this,null,function*(){const{match:{params:{id:e}}}=this.props,{username:t}=this.state;Q.b.Account.username(t)?(yield this.setStatePromise({loading:!0}),(yield f.d.addAccount({id:Number.parseInt(e)},{username:t}))!==null&&(A.a.success({message:`\u6DFB\u52A0\u6210\u5458 ${t} \u6210\u529F`}),yield this.setStatePromise({showModal:!1}),P.emit(v.addMember)),yield this.setStatePromise({loading:!1})):A.a.error({message:`\u7528\u6237 ${t} \u4E0D\u5B58\u5728`})}),this.onModalCancelClick=()=>S(this,null,function*(){yield this.setStatePromise({showModal:!1})}),this.onUsernameChange=e=>{this.setState({username:e.target.value})},this.state={showModal:!1,username:"",loading:!1}}render(){const{showModal:r,username:e,loading:t}=this.state;return n.a.createElement(G,{loading:t,showModal:r,username:e,onClick:this.onClick,onModalCancelClick:this.onModalCancelClick,onModalOkClick:this.onModalOkClick,onUsernameChange:this.onUsernameChange})}}var Z=Object(b.j)(Y),k=a(209);function w(m){const{profiles:r,loading:e,isAdmin:t,adminUsernames:s,onSetAdminConfirm:o,onRemoveAccountConfirm:c,onRemoveAdminConfirm:d}=m;return n.a.createElement("div",{className:p.a.Members},n.a.createElement("div",{className:p.a.topArea},n.a.createElement(W.a,{type:"info",showIcon:!0,message:"\u53EA\u6709\u5C0F\u7EC4\u6210\u5458\u53EF\u5C06\u4ED3\u5E93\u52A0\u5165\u5C0F\u7EC4"}),n.a.createElement("div",{className:p.a.addMemberButtonWrapper},t?n.a.createElement(Z,null):null)),n.a.createElement(O.b,{loading:e,locale:{emptyText:n.a.createElement(R.a,{description:"\u6CA1\u6709\u6210\u5458"})},dataSource:[...r],renderItem:i=>{if(i!==null){const{nickname:l,username:h,avatar:te}=i;return n.a.createElement(T.a,{size:"small",key:h},n.a.createElement("div",{className:p.a.cardContent},n.a.createElement($.a,{className:p.a.titleWrapper,to:V.Function.generatePersonalCenterRoute({username:h})},n.a.createElement("div",{className:p.a.avatarWrapper},n.a.createElement(k.a,{avatar:te})),n.a.createElement("div",{className:p.a.name},l,"(",h,")"),n.a.createElement("div",{className:p.a.isAdminTagWrapper},s.includes(h)?n.a.createElement(U.a,{color:"blue",className:p.a.isAdminTag},"\u7BA1\u7406\u5458"):null)),t?n.a.createElement("div",{className:p.a.buttonWrapper},n.a.createElement(j.b,{size:-1},s.includes(h)?n.a.createElement(g.a,{title:`\u786E\u8BA4\u64A4\u9500\u6210\u5458 ${h} \u7684\u7BA1\u7406\u5458\u6743\u9650\uFF1F`,onConfirm:d(h),disabled:e},n.a.createElement(E.a,{loading:e,disabled:e},"\u64A4\u9500\u7BA1\u7406\u5458")):n.a.createElement(g.a,{title:`\u786E\u8BA4\u8BBE\u7F6E\u6210\u5458 ${h} \u4E3A\u7BA1\u7406\u5458\uFF1F`,onConfirm:o(h),disabled:e},n.a.createElement(E.a,{type:"primary",loading:e,disabled:e},"\u8BBE\u4E3A\u7BA1\u7406\u5458")),n.a.createElement(g.a,{title:`\u786E\u8BA4\u79FB\u9664\u6210\u5458 ${h}\uFF1F`,onConfirm:c(h),disabled:e},n.a.createElement(E.a,{type:"primary",danger:!0,loading:e,disabled:e},"\u79FB\u9664")))):null))}else return null}}))}var q=n.a.memo(w),I,ae=typeof I!="undefined"?I:m=>{throw new Error('Dynamic require of "'+m+'" is not supported')},u=(m,r,e)=>new Promise((t,s)=>{var o=i=>{try{d(e.next(i))}catch(l){s(l)}},c=i=>{try{d(e.throw(i))}catch(l){s(l)}},d=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,c);d((e=e.apply(m,r)).next())});class _ extends M.PureComponent{constructor(r){super(r);this.setStatePromise=Object(F.promisify)(this.setState),this.onAddMemberListener=()=>u(this,null,function*(){return yield this.componentDidMount()}),this.removeAccount=e=>u(this,null,function*(){const{accounts:t,profiles:s,admins:o}=this.state,c=t.filter(({username:l})=>l!==e),d=s.filter(l=>l!==null&&l.username!==e),i=o.filter(({username:l})=>l!==e);yield this.setStatePromise({accounts:c,profiles:d,admins:i})}),this.addAdmin=e=>u(this,null,function*(){const{accounts:t,admins:s}=this.state,o=Array.from(s);for(const c of t)if(c.username===e){o.push(c);break}yield this.setStatePromise({admins:o})}),this.removeAdmin=e=>u(this,null,function*(){const{admins:t}=this.state,s=t.filter(({username:o})=>o!==e);yield this.setStatePromise({admins:s})}),this.loadIsAdmin=()=>u(this,null,function*(){const{match:{params:{id:e}}}=this.props,t=yield f.d.isAdmin({id:Number.parseInt(e)});if(t!==null){const{isAdmin:s}=t;yield this.setStatePromise({isAdmin:s})}}),this.loadAccounts=()=>u(this,null,function*(){const{match:{params:{id:e}}}=this.props,t=yield f.d.accounts({id:Number.parseInt(e)});t!==null&&(yield this.setStatePromise({accounts:t}))}),this.loadAdmins=()=>u(this,null,function*(){const{match:{params:{id:e}}}=this.props,t=yield f.d.admins({id:Number.parseInt(e)});t!==null&&(yield this.setStatePromise({admins:t}))}),this.loadProfiles=()=>u(this,null,function*(){const{accounts:e}=this.state,t=yield Promise.all(e.map(({username:s})=>f.g.get({username:s})));yield this.setStatePromise({profiles:t})}),this.onRemoveAccountConfirm=e=>{const{match:{params:{id:t}}}=this.props;return()=>u(this,null,function*(){yield this.setStatePromise({loading:!0}),(yield f.d.removeAccounts({id:Number.parseInt(t)},[e]))!==null&&(A.a.success({message:"\u79FB\u9664\u6210\u5458\u6210\u529F"}),yield this.removeAccount(e)),yield this.setStatePromise({loading:!1})})},this.onSetAdminConfirm=e=>{const{match:{params:{id:t}}}=this.props;return()=>u(this,null,function*(){yield this.setStatePromise({loading:!0}),(yield f.d.addAdmin({id:Number.parseInt(t)},{username:e}))!==null&&(A.a.success({message:`\u6210\u529F\u8BBE\u7F6E ${e} \u4E3A\u7BA1\u7406\u5458`}),yield this.addAdmin(e)),yield this.setStatePromise({loading:!1})})},this.onRemoveAdminConfirm=e=>{const{match:{params:{id:t}}}=this.props;return()=>u(this,null,function*(){yield this.setStatePromise({loading:!0}),(yield f.d.removeAdmins({id:Number.parseInt(t)},[e]))!==null&&(A.a.success({message:`\u6210\u529F\u64A4\u9500 ${e} \u7684\u7BA1\u7406\u5458\u8EAB\u4EFD`}),yield this.removeAdmin(e)),yield this.setStatePromise({loading:!1})})},this.state={accounts:[],admins:[],profiles:[],loading:!0,isAdmin:!1},P.on(v.addMember,this.onAddMemberListener)}componentDidMount(){return u(this,null,function*(){yield this.setStatePromise({loading:!0}),yield Promise.all([this.loadAccounts(),this.loadAdmins(),this.loadIsAdmin()]),yield this.loadProfiles(),yield this.setStatePromise({loading:!1})})}componentDidUpdate(r,e,t){return u(this,null,function*(){const{match:{params:{id:s}}}=this.props,{match:{params:{id:o}}}=r;s!==o&&(yield this.componentDidMount())})}componentWillUnmount(){P.removeListener(v.addMember,this.onAddMemberListener)}render(){const{profiles:r,loading:e,isAdmin:t,admins:s}=this.state;return n.a.createElement(q,{profiles:r,loading:e,isAdmin:t,adminUsernames:s.map(({username:o})=>o),onRemoveAccountConfirm:this.onRemoveAccountConfirm,onSetAdminConfirm:this.onSetAdminConfirm,onRemoveAdminConfirm:this.onRemoveAdminConfirm})}}var ee=Object(b.j)(_)}}]);

//# sourceMappingURL=39.bcaa5da5.chunk.js.map