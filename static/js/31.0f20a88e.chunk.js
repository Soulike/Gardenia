(this["webpackJsonpsoulike-git"]=this["webpackJsonpsoulike-git"]||[]).push([[31],{1016:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(15);t.a=r.a.memo((function(e){return r.a.createElement(o.b,Object.assign({},e,{target:"_blank",rel:"noopener norefferrer"}))}))},1019:function(e,t,n){"use strict";var a=n(1016);n.d(t,"a",(function(){return a.a}))},1120:function(e,t,n){e.exports={Conflict:"Style_Conflict__3Vamq",conflictsWrapper:"Style_conflictsWrapper__1FN4k",conflictWrapper:"Style_conflictWrapper__2qm8Q",buttonWrapper:"Style_buttonWrapper__1QhqS"}},1123:function(e,t,n){e.exports={ConflictEditor:"Style_ConflictEditor__p1WcR",header:"Style_header__3Oayj",filePath:"Style_filePath__1iCwK",checkboxWrapper:"Style_checkboxWrapper__VLdFN",text:"Style_text__3S4yB"}},1234:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return D}));var a=n(1),r=n.n(a),o=(n(62),n(29)),c=n(3),s=n(9),i=n(10),l=n(17),u=n(18),p=n(0),f=n.n(p),m=(n(108),n(45)),h=(n(341),n(143)),d=(n(73),n(21)),b=(n(338),n(150)),v=n(1120),g=n.n(v),y=n(1019),C=n(22),k=n(19),E=(n(1121),n(1214)),x=n(1123),R=n.n(x),_=f.a.lazy((function(){return Promise.all([n.e(9),n.e(47)]).then(n.bind(null,1219))}));var w=f.a.memo((function(e){var t=e.conflict.filePath,n=e.code,a=e.onCodeChange,r=e.onResolvedCheckboxChange,o=e.resolved;return f.a.createElement("div",{className:R.a.ConflictEditor},f.a.createElement("div",{className:R.a.header},f.a.createElement("code",{className:R.a.filePath},t),f.a.createElement("label",{className:R.a.checkboxWrapper},f.a.createElement(E.a,{onChange:r,checked:o}),f.a.createElement("div",{className:R.a.text},"\u5df2\u89e3\u51b3"))),f.a.createElement("div",{className:R.a.codeWrapper,style:o?{position:"fixed",top:"99999999px"}:{}},f.a.createElement(_,{onBeforeChange:a,value:n,options:{lineNumbers:!0,indentUnit:0}})))})),N=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).onCodeChange=function(e,t,n){a.setState({code:n})},a.onResolvedCheckboxChange=function(e){var t=a.state.code,n=a.props.conflict.filePath;-1!==t.search(/^<<<<<<< .+$/m)||-1!==t.search(/^=======$/m)||-1!==t.search(/^>>>>>>> .+$/m)?o.a.warning({message:f.a.createElement("div",null,f.a.createElement("code",null,n)," \u4e2d\u4ecd\u5b58\u5728\u51b2\u7a81"),description:"\u8bf7\u89e3\u51b3\u51b2\u7a81\uff0c\u5e76\u5220\u9664\u6240\u6709\u7684\u51b2\u7a81\u6807\u8bb0"}):a.setState({resolved:e.target.checked})},a.state={code:"",resolved:!1},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.conflict.content;this.setState({code:e})}},{key:"componentDidUpdate",value:function(){var e=Object(c.a)(r.a.mark((function e(t,n,a){var o,c,s,i,l,u,p,f,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.props.conflict,c=t.conflict,o===c){e.next=5;break}return e.next=5,this.componentDidMount();case 5:if("function"!==typeof(s=this.props.onChange)){e.next=13;break}if(i=this.state,l=i.code,u=i.resolved,p=o.filePath,f=n.code,m=n.resolved,l===f&&u===m){e.next=13;break}return e.next=13,s(p,u,l);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.code,n=e.resolved,a=this.props.conflict;return f.a.createElement(w,{conflict:a,code:t,onCodeChange:this.onCodeChange,resolved:n,onResolvedCheckboxChange:this.onResolvedCheckboxChange})}}]),n}(p.PureComponent);var O=f.a.memo((function(e){var t=e.loading,n=e.pullRequest,a=n.sourceRepositoryUsername,r=n.sourceRepositoryName,o=n.sourceRepositoryBranchName,c=n.targetRepositoryUsername,s=n.targetRepositoryName,i=n.targetRepositoryBranchName,l=e.conflicts,u=e.onConflictChange,p=e.onSubmitButtonClick;return f.a.createElement("div",{className:g.a.Conflict},f.a.createElement(m.a,{spinning:t},f.a.createElement("div",{className:g.a.alert},f.a.createElement(b.a,{type:"info",banner:!0,showIcon:!0,message:f.a.createElement("div",null,"\u6b63\u5728\u89e3\u51b3 ",f.a.createElement(y.a,{to:C.Function.generateRepositoryCodeRoute({username:a,repository:r,objectType:k.b.TREE,branch:o})},f.a.createElement("code",null,a,"/",r,":",o))," \u5230 ",f.a.createElement(y.a,{to:C.Function.generateRepositoryCodeRoute({username:c,repository:s,objectType:k.b.TREE,branch:i})},f.a.createElement("code",null,c,"/",s,":",i))," \u7684\u5408\u5e76\u51b2\u7a81")}),f.a.createElement(b.a,{type:"warning",banner:!0,showIcon:!0,message:f.a.createElement("div",null,"\u6240\u505a\u7684\u4fee\u6539\u5c06\u88ab\u63d0\u4ea4\u5230 ",f.a.createElement("code",null,a,"/",r,":",o))})),f.a.createElement("div",{className:g.a.conflictsWrapper},l.map((function(e){return f.a.createElement("div",{key:e.filePath,className:g.a.conflictWrapper},f.a.createElement(N,{conflict:e,onChange:u}))}))),f.a.createElement("div",{className:g.a.buttonWrapper},f.a.createElement(h.a,{onConfirm:p,disabled:t,title:f.a.createElement("div",null,"\u786e\u8ba4\u51b2\u7a81\u89e3\u51b3\uff1f",f.a.createElement("br",null),f.a.createElement("strong",null,"\u4ee5\u4e0a\u4fee\u6539\u90fd\u5c06\u88ab\u63d0\u4ea4\u5230 ",f.a.createElement("code",null,a,"/",r,":",o)))},f.a.createElement(d.a,{type:"primary",size:"large",disabled:t,loading:t},"\u63d0\u4ea4")))))})),S=n(126),P=n(134),j=n(28),q=C.CONFIG.PAGE_ID,F=C.CONFIG.PAGE_ID_TO_ROUTE,W=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).checkURL=function(){var e=a.props,t=e.match.params.no,n=e.history,r=Number.parseInt(t);if(Number.isNaN(r))return n.replace(F[q.NOT_FOUND])},a.loadPullRequest=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(r.a.mark((function e(t){var n,c,s,i,l,u,p,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,c=n.match.params,s=c.username,i=c.repository,l=c.no,u=n.history,p=Number.parseInt(l),e.next=4,j.f.get({username:s,name:i},{no:p});case 4:if(null===(f=e.sent)){e.next=14;break}if(f.status===k.c.OPEN){e.next=11;break}return o.a.warn({message:"Pull Request #".concat(p," \u5df2\u5173\u95ed\u6216\u5408\u5e76")}),t(),e.abrupt("return",u.replace(C.Function.generateRepositoryPullRequestRoute({username:s,repository:i,no:l})));case 11:a.setState({pullRequest:f},(function(){return t()})),e.next=16;break;case 14:return t(),e.abrupt("return",u.replace(F[q.NOT_FOUND]));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),a.loadConflicts=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(c.a)(r.a.mark((function e(t){var n,c,s,i,l,u,p,f,m,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.pullRequest,c=n.id,e.next=4,j.f.getConflicts({id:c});case 4:if(null===(s=e.sent)){e.next=18;break}if(i=s.conflicts,l=a.props,u=l.match.params,p=u.username,f=u.repository,m=u.no,h=l.history,0!==i.length){e.next=14;break}return o.a.warn({message:"".concat(p,"/").concat(f," #").concat(m," \u6ca1\u6709\u5408\u5e76\u51b2\u7a81"),description:"\u60a8\u53ef\u76f4\u63a5\u6267\u884c\u5408\u5e76\u64cd\u4f5c"}),t(),e.abrupt("return",h.replace(C.Function.generateRepositoryPullRequestRoute({username:p,repository:f,no:m})));case 14:i.forEach((function(e){if(e.isBinary)return o.a.warn({message:"\u5b58\u5728\u4e8c\u8fdb\u5236\u6587\u4ef6\u51b2\u7a81",description:"\u8bf7\u4f7f\u7528\u547d\u4ee4\u884c\u89e3\u51b3\u51b2\u7a81"}),t(),h.replace(C.Function.generateRepositoryPullRequestRoute({username:p,repository:f,no:m}))}));case 15:a.setState({conflicts:i},(function(){return t()})),e.next=19;break;case 18:t();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),a.onConflictChange=function(e,t,n){for(var r=a.state,o=r.conflicts,c=r.resolvedFilePath,s=0;s<o.length;s++){var i=o[s],l=i.filePath,u=i.isBinary,p=i.content;l===e&&n!==p&&(o[s]=new P.c(e,u,n)),t?c.add(e):c.delete(e)}},a.onSubmitButtonClick=Object(c.a)(r.a.mark((function e(){var t,n,c,s,i,l,u,p,f,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,n=t.pullRequest.id,c=t.resolvedFilePath,s=t.conflicts,s.map((function(e){return e.filePath})).length===c.size){e.next=6;break}o.a.error({message:"\u8bf7\u89e3\u51b3\u6240\u6709\u51b2\u7a81\u540e\u518d\u63d0\u4ea4"}),e.next=15;break;case 6:return a.setState({loading:!0}),e.next=9,j.f.resolveConflicts({id:n},s);case 9:if(null===e.sent){e.next=14;break}return o.a.success({message:"\u89e3\u51b3\u51b2\u7a81\u6210\u529f"}),i=a.props,l=i.history,u=i.match.params,p=u.username,f=u.repository,m=u.no,e.abrupt("return",l.push(C.Function.generateRepositoryPullRequestRoute({username:p,repository:f,no:m})));case 14:a.setState({loading:!1});case 15:case"end":return e.stop()}}),e)}))),a.state={pullRequest:new P.g(0,0,"","","","","","","","",0,0,"","",k.c.CLOSED),conflicts:[],loading:!1,resolvedFilePath:new Set},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkURL(),this.setState({loading:!0}),e.next=4,this.loadPullRequest();case 4:this.setState({loading:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(c.a)(r.a.mark((function e(t,n,a){var o,c,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.props.location.pathname,c=this.props.location.pathname,o===c){e.next=5;break}return e.next=5,this.componentDidMount();case 5:if(s=this.state.pullRequest.id,n.pullRequest.id===s){e.next=12;break}return this.setState({loading:!0}),e.next=11,this.loadConflicts();case 11:this.setState({loading:!1});case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.pullRequest,a=e.conflicts;return f.a.createElement(O,{loading:t,pullRequest:n,conflicts:a,onConflictChange:this.onConflictChange,onSubmitButtonClick:this.onSubmitButtonClick})}}]),n}(p.PureComponent),D=Object(S.f)(W)}}]);
//# sourceMappingURL=31.0f20a88e.chunk.js.map