"use strict";(self.webpackChunksoulike_git=self.webpackChunksoulike_git||[]).push([[7158],{77158:function(K,E,i){i.r(E),i.d(E,{default:function(){return V}});var t=i(89526),N={Notifications:"Style_Notifications__m7Vi3",loadMoreButtonWrapper:"Style_loadMoreButtonWrapper__KMG1j"},g=i(34405),W=i(5892),v=i(39207),y=i(30592),D=i(37109),s={Notification:"Style_Notification__Jzi1X",left:"Style_left__kEp7v",right:"Style_right__jhEi0",unconfirmedDotWrapper:"Style_unconfirmedDotWrapper__0Xhzz",unconfirmedDot:"Style_unconfirmedDot__84Aqr",iconWrapper:"Style_iconWrapper__TFAoL",contentWrapper:"Style_contentWrapper__NyWnM",typeWrapper:"Style_typeWrapper__Butye",timeWrapper:"Style_timeWrapper__vh2iD",buttonWrapper:"Style_buttonWrapper__X73it"},h=i(43546),O=i(65293),M=i(30511),Z=i(24874),F=i(1413),T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},I=T,k=i(36593),P=function(e,n){return t.createElement(k.Z,(0,F.Z)((0,F.Z)({},e),{},{ref:n,icon:I}))};P.displayName="ReloadOutlined";var R=t.forwardRef(P),S=i(14006);function U(r){const{notification:{id:e,confirmed:n,content:c,type:l,timestamp:d},onConfirmButtonClickFactory:a,onUnconfirmButtonClickFactory:o}=r;return t.createElement(v.ZP.Item,null,t.createElement("div",{className:s.Notification},t.createElement("div",{className:s.left},t.createElement("div",{className:s.unconfirmedDotWrapper},n?null:t.createElement("span",{className:s.unconfirmedDot})),t.createElement("div",{className:s.iconWrapper},t.createElement(M.Z,null)),t.createElement("div",{className:s.contentWrapper},c)),t.createElement("div",{className:s.right},t.createElement("div",{className:s.typeWrapper},l),t.createElement("div",{className:s.timeWrapper},t.createElement(h.Z,{title:S.Ej.parseTimestampToDate(d)},t.createElement("span",null,S.Ej.parseTimestampToDifference(d)))),t.createElement("div",{className:s.buttonWrapper},t.createElement(O.Z,{size:-1},t.createElement(h.Z,{title:"\u786E\u8BA4\u6D88\u606F"},t.createElement(y.Z,{onClick:a(e),size:"small",disabled:n},t.createElement(Z.Z,null))),t.createElement(h.Z,{title:"\u64A4\u9500\u786E\u8BA4\u6D88\u606F"},t.createElement(y.Z,{onClick:o(e),size:"small",disabled:!n},t.createElement(R,null))))))))}var z=t.memo(U);function L(r){const{notifications:e,unconfirmedNotificationCount:n,onConfirmButtonClickFactory:c,onUnconfirmButtonClickFactory:l,onLoadMoreButtonClick:d,loading:a}=r;return t.createElement("div",{className:N.Notifications},t.createElement(g.Z,{title:t.createElement("div",null,"\u6D88\u606F (",n," \u6761\u672A\u786E\u8BA4)")},t.createElement(W.Z,{spinning:a},e.length>0?t.createElement(t.Fragment,null,t.createElement(v.ZP,{bordered:!0,size:"small"},e.map(o=>t.createElement(z,{notification:o,onConfirmButtonClickFactory:c,onUnconfirmButtonClickFactory:l,key:o.id}))),t.createElement("div",{className:N.loadMoreButtonWrapper},t.createElement(y.Z,{type:"primary",disabled:a,loading:a,onClick:d},"\u52A0\u8F7D\u66F4\u591A"))):t.createElement(D.Z,{description:"\u6CA1\u6709\u6D88\u606F"}))))}var j=t.memo(L),G=i(60269),C=i(62371),A=i(24315),m=(r,e,n)=>new Promise((c,l)=>{var d=u=>{try{o(n.next(u))}catch(f){l(f)}},a=u=>{try{o(n.throw(u))}catch(f){l(f)}},o=u=>u.done?c(u.value):Promise.resolve(u.value).then(d,a);o((n=n.apply(r,e)).next())});const p=class extends t.PureComponent{constructor(r){super(r);this.setStatePromise=e=>new Promise(n=>{this.setState(e,()=>{n()})}),this.loadNotificationCount=()=>m(this,null,function*(){const e=yield C.P_.getCount({confirmed:!1});if(e!==null){const{count:n}=e;yield this.setStatePromise({unconfirmedNotificationCount:n})}}),this.onSetConfirmedButtonClickFactory=(e,n)=>()=>m(this,null,function*(){if(yield this.setStatePromise({loading:!0}),(yield C.P_.setConfirmed([{id:e}],n))!==null){const{notifications:l,unconfirmedNotificationCount:d}=this.state,a=[...l];for(let o=0;o<a.length;o++)if(a[o].id===e){const{id:u,timestamp:f,content:X,type:x,username:J}=a[o];a[o]=new G.P_(u,J,X,x,f,n);break}yield this.setStatePromise({notifications:a,unconfirmedNotificationCount:d+(n?-1:1)})}yield this.setStatePromise({loading:!1})}),this.onConfirmButtonClickFactory=e=>this.onSetConfirmedButtonClickFactory(e,!0),this.onUnconfirmButtonClickFactory=e=>this.onSetConfirmedButtonClickFactory(e,!1),this.onLoadMoreButtonClick=()=>m(this,null,function*(){yield this.loadMoreNotifications()}),this.loadMoreNotifications=()=>m(this,null,function*(){const{loadEnd:e,lastLoadPosition:n}=this.state;if(e)A.Z.success({message:"\u5DF2\u52A0\u8F7D\u6240\u6709\u6D88\u606F"});else{yield this.setStatePromise({loading:!0});const c=yield C.P_.get({},n,p.NOTIFICATION_AMOUNT_PER_PAGE);if(c!==null){const{notifications:l}=c;l.length<p.NOTIFICATION_AMOUNT_PER_PAGE&&(A.Z.success({message:"\u5DF2\u52A0\u8F7D\u6240\u6709\u6D88\u606F"}),yield this.setStatePromise({loadEnd:!0})),yield this.setStatePromise({notifications:[...this.state.notifications,...l],loading:!1,lastLoadPosition:n+p.NOTIFICATION_AMOUNT_PER_PAGE})}}}),this.state={notifications:[],loading:!1,lastLoadPosition:0,loadEnd:!1,unconfirmedNotificationCount:0}}componentDidMount(){return m(this,null,function*(){yield this.setStatePromise({loading:!0}),yield Promise.all([this.loadNotificationCount(),this.loadMoreNotifications()]),yield this.setStatePromise({loading:!1})})}render(){const{notifications:r,loading:e,unconfirmedNotificationCount:n}=this.state;return t.createElement(j,{notifications:r,unconfirmedNotificationCount:n,loading:e,onConfirmButtonClickFactory:this.onConfirmButtonClickFactory,onUnconfirmButtonClickFactory:this.onUnconfirmButtonClickFactory,onLoadMoreButtonClick:this.onLoadMoreButtonClick})}};let B=p;B.NOTIFICATION_AMOUNT_PER_PAGE=20;var V=B}}]);

//# sourceMappingURL=7158.3f55429c.chunk.js.map