(this["webpackJsonpsoulike-git"]=this["webpackJsonpsoulike-git"]||[]).push([[38],{1045:function(e,n,t){e.exports={Members:"Style_Members__1A1TA",topArea:"Style_topArea__2Rqcb",cardContent:"Style_cardContent__3XM0M",titleWrapper:"Style_titleWrapper__30lrm",name:"Style_name__35BXt",isAdminTagWrapper:"Style_isAdminTagWrapper__h56El",isAdminTag:"Style_isAdminTag__3vPt2",avatarWrapper:"Style_avatarWrapper__31DG6",avatar:"Style_avatar__39V_0"}},1046:function(e,n,t){e.exports={modalContent:"Style_modalContent__2QoB9",usernameInput:"Style_usernameInput__2TSrf"}},1292:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return V}));var a={};t.r(a),t.d(a,"addMember",(function(){return F}));var r=t(212),s=t(2),i=t.n(s),c=t(6),o=t(15),u=t(16),m=t(39),d=t(38),l=t(0),p=t.n(l),f=t(89),b=t(1045),x=t.n(b),h=t(834),j=t(1320),v=t(181),O=t(831),k=t(835),A=t(836),g=t(823),C=t(109),w=t(56),S=t(269),M=t(827),_=t(826),y=t(471),P=t(1046),N=t.n(P),I=t(1);function W(e){var n=e.onClick,t=e.showModal,a=e.username,r=e.loading,s=e.onModalCancelClick,i=e.onModalOkClick,c=e.onUsernameChange;return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsxs)(C.a,{type:"primary",onClick:n,loading:r,disabled:r,children:[Object(I.jsx)(y.a,{}),"\u6dfb\u52a0\u6210\u5458"]}),Object(I.jsx)(M.a,{destroyOnClose:!0,width:300,title:"\u6dfb\u52a0\u5c0f\u7ec4\u6210\u5458",visible:t,onOk:i,onCancel:s,confirmLoading:r,children:Object(I.jsx)("div",{className:N.a.modalContent,children:Object(I.jsx)(_.a,{value:a,onChange:c,autoFocus:!0,placeholder:"\u65b0\u5c0f\u7ec4\u6210\u5458\u7684\u7528\u6237\u540d",className:N.a.usernameInput})})})]})}var R=p.a.memo(W),T=t(102),U=t(54),D=t(34),L=t(153),B=t(327),E=new(t(135).EventEmitter),F="addMember",z=function(e){Object(m.a)(t,e);var n=Object(d.a)(t);function t(e){var r;return Object(o.a)(this,t),(r=n.call(this,e)).setStatePromise=Object(T.promisify)(r.setState),r.initModal=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.setStatePromise({username:""});case 1:case"end":return e.stop()}}),e)}))),r.onClick=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.setStatePromise({showModal:!0});case 2:return e.next=4,r.initModal();case 4:case"end":return e.stop()}}),e)}))),r.onModalOkClick=Object(c.a)(i.a.mark((function e(){var n,t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.props.match.params.id,t=r.state.username,L.b.Account.username(t)){e.next=6;break}B.a.error({message:"\u7528\u6237 ".concat(t," \u4e0d\u5b58\u5728")}),e.next=18;break;case 6:return e.next=8,r.setStatePromise({loading:!0});case 8:return e.next=10,D.d.addAccount({id:Number.parseInt(n)},{username:t});case 10:if(null===e.sent){e.next=16;break}return B.a.success({message:"\u6dfb\u52a0\u6210\u5458 ".concat(t," \u6210\u529f")}),e.next=15,r.setStatePromise({showModal:!1});case 15:E.emit(a.addMember);case 16:return e.next=18,r.setStatePromise({loading:!1});case 18:case"end":return e.stop()}}),e)}))),r.onModalCancelClick=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.setStatePromise({showModal:!1});case 2:case"end":return e.stop()}}),e)}))),r.onUsernameChange=function(e){r.setState({username:e.target.value})},r.state={showModal:!1,username:"",loading:!1},r}return Object(u.a)(t,[{key:"render",value:function(){var e=this.state,n=e.showModal,t=e.username,a=e.loading;return Object(I.jsx)(R,{loading:a,showModal:n,username:t,onClick:this.onClick,onModalCancelClick:this.onModalCancelClick,onModalOkClick:this.onModalOkClick,onUsernameChange:this.onUsernameChange})}}]),t}(l.PureComponent),J=Object(U.j)(z),X=t(216);function q(e){var n=e.profiles,t=e.loading,a=e.isAdmin,r=e.adminUsernames,s=e.onSetAdminConfirm,i=e.onRemoveAccountConfirm,c=e.onRemoveAdminConfirm;return Object(I.jsxs)("div",{className:x.a.Members,children:[Object(I.jsxs)("div",{className:x.a.topArea,children:[Object(I.jsx)(h.a,{type:"info",showIcon:!0,message:"\u53ea\u6709\u5c0f\u7ec4\u6210\u5458\u53ef\u5c06\u4ed3\u5e93\u52a0\u5165\u5c0f\u7ec4"}),Object(I.jsx)("div",{className:x.a.addMemberButtonWrapper,children:a?Object(I.jsx)(J,{}):null})]}),Object(I.jsx)(j.b,{loading:t,locale:{emptyText:Object(I.jsx)(v.a,{description:"\u6ca1\u6709\u6210\u5458"})},dataSource:Object(f.a)(n),renderItem:function(e){if(null!==e){var n=e.nickname,o=e.username,u=e.avatar;return Object(I.jsx)(O.a,{size:"small",children:Object(I.jsxs)("div",{className:x.a.cardContent,children:[Object(I.jsxs)(S.a,{className:x.a.titleWrapper,to:w.Function.generatePersonalCenterRoute({username:o}),children:[Object(I.jsx)("div",{className:x.a.avatarWrapper,children:Object(I.jsx)(X.a,{avatar:u})}),Object(I.jsxs)("div",{className:x.a.name,children:[n,"(",o,")"]}),Object(I.jsx)("div",{className:x.a.isAdminTagWrapper,children:r.includes(o)?Object(I.jsx)(k.a,{color:"blue",className:x.a.isAdminTag,children:"\u7ba1\u7406\u5458"}):null})]}),a?Object(I.jsx)("div",{className:x.a.buttonWrapper,children:Object(I.jsxs)(A.b,{size:-1,children:[r.includes(o)?Object(I.jsx)(g.a,{title:"\u786e\u8ba4\u64a4\u9500\u6210\u5458 ".concat(o," \u7684\u7ba1\u7406\u5458\u6743\u9650\uff1f"),onConfirm:c(o),disabled:t,children:Object(I.jsx)(C.a,{loading:t,disabled:t,children:"\u64a4\u9500\u7ba1\u7406\u5458"})}):Object(I.jsx)(g.a,{title:"\u786e\u8ba4\u8bbe\u7f6e\u6210\u5458 ".concat(o," \u4e3a\u7ba1\u7406\u5458\uff1f"),onConfirm:s(o),disabled:t,children:Object(I.jsx)(C.a,{type:"primary",loading:t,disabled:t,children:"\u8bbe\u4e3a\u7ba1\u7406\u5458"})}),Object(I.jsx)(g.a,{title:"\u786e\u8ba4\u79fb\u9664\u6210\u5458 ".concat(o,"\uff1f"),onConfirm:i(o),disabled:t,children:Object(I.jsx)(C.a,{type:"primary",danger:!0,loading:t,disabled:t,children:"\u79fb\u9664"})})]})}):null]})},o)}return null}})]})}var G=p.a.memo(q),Q=function(e){Object(m.a)(t,e);var n=Object(d.a)(t);function t(e){var s;return Object(o.a)(this,t),(s=n.call(this,e)).setStatePromise=Object(T.promisify)(s.setState),s.onAddMemberListener=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.componentDidMount();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),s.removeAccount=function(){var e=Object(c.a)(i.a.mark((function e(n){var t,a,r,c,o,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.state,a=t.accounts,r=t.profiles,c=t.admins,o=a.filter((function(e){return e.username!==n})),u=r.filter((function(e){return null!==e&&e.username!==n})),m=c.filter((function(e){return e.username!==n})),e.next=6,s.setStatePromise({accounts:o,profiles:u,admins:m});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),s.addAdmin=function(){var e=Object(c.a)(i.a.mark((function e(n){var t,a,c,o,u,m,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.state,a=t.accounts,c=t.admins,o=Array.from(c),u=Object(r.a)(a),e.prev=3,u.s();case 5:if((m=u.n()).done){e.next=12;break}if((d=m.value).username!==n){e.next=10;break}return o.push(d),e.abrupt("break",12);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),u.e(e.t0);case 17:return e.prev=17,u.f(),e.finish(17);case 20:return e.next=22,s.setStatePromise({admins:o});case 22:case"end":return e.stop()}}),e,null,[[3,14,17,20]])})));return function(n){return e.apply(this,arguments)}}(),s.removeAdmin=function(){var e=Object(c.a)(i.a.mark((function e(n){var t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.state.admins,a=t.filter((function(e){return e.username!==n})),e.next=4,s.setStatePromise({admins:a});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),s.loadIsAdmin=Object(c.a)(i.a.mark((function e(){var n,t,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.props.match.params.id,e.next=3,D.d.isAdmin({id:Number.parseInt(n)});case 3:if(null===(t=e.sent)){e.next=8;break}return a=t.isAdmin,e.next=8,s.setStatePromise({isAdmin:a});case 8:case"end":return e.stop()}}),e)}))),s.loadAccounts=Object(c.a)(i.a.mark((function e(){var n,t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.props.match.params.id,e.next=3,D.d.accounts({id:Number.parseInt(n)});case 3:if(null===(t=e.sent)){e.next=7;break}return e.next=7,s.setStatePromise({accounts:t});case 7:case"end":return e.stop()}}),e)}))),s.loadAdmins=Object(c.a)(i.a.mark((function e(){var n,t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.props.match.params.id,e.next=3,D.d.admins({id:Number.parseInt(n)});case 3:if(null===(t=e.sent)){e.next=7;break}return e.next=7,s.setStatePromise({admins:t});case 7:case"end":return e.stop()}}),e)}))),s.loadProfiles=Object(c.a)(i.a.mark((function e(){var n,t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.state.accounts,e.next=3,Promise.all(n.map((function(e){var n=e.username;return D.g.get({username:n})})));case 3:return t=e.sent,e.next=6,s.setStatePromise({profiles:t});case 6:case"end":return e.stop()}}),e)}))),s.onRemoveAccountConfirm=function(e){var n=s.props.match.params.id;return Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.setStatePromise({loading:!0});case 2:return t.next=4,D.d.removeAccounts({id:Number.parseInt(n)},[e]);case 4:if(null===t.sent){t.next=9;break}return B.a.success({message:"\u79fb\u9664\u6210\u5458\u6210\u529f"}),t.next=9,s.removeAccount(e);case 9:return t.next=11,s.setStatePromise({loading:!1});case 11:case"end":return t.stop()}}),t)})))},s.onSetAdminConfirm=function(e){var n=s.props.match.params.id;return Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.setStatePromise({loading:!0});case 2:return t.next=4,D.d.addAdmin({id:Number.parseInt(n)},{username:e});case 4:if(null===t.sent){t.next=9;break}return B.a.success({message:"\u6210\u529f\u8bbe\u7f6e ".concat(e," \u4e3a\u7ba1\u7406\u5458")}),t.next=9,s.addAdmin(e);case 9:return t.next=11,s.setStatePromise({loading:!1});case 11:case"end":return t.stop()}}),t)})))},s.onRemoveAdminConfirm=function(e){var n=s.props.match.params.id;return Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.setStatePromise({loading:!0});case 2:return t.next=4,D.d.removeAdmins({id:Number.parseInt(n)},[e]);case 4:if(null===t.sent){t.next=9;break}return B.a.success({message:"\u6210\u529f\u64a4\u9500 ".concat(e," \u7684\u7ba1\u7406\u5458\u8eab\u4efd")}),t.next=9,s.removeAdmin(e);case 9:return t.next=11,s.setStatePromise({loading:!1});case 11:case"end":return t.stop()}}),t)})))},s.state={accounts:[],admins:[],profiles:[],loading:!0,isAdmin:!1},E.on(a.addMember,s.onAddMemberListener),s}return Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setStatePromise({loading:!0});case 2:return e.next=4,Promise.all([this.loadAccounts(),this.loadAdmins(),this.loadIsAdmin()]);case 4:return e.next=6,this.loadProfiles();case 6:return e.next=8,this.setStatePromise({loading:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(c.a)(i.a.mark((function e(n,t,a){var r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props.match.params.id,s=n.match.params.id,r===s){e.next=5;break}return e.next=5,this.componentDidMount();case 5:case"end":return e.stop()}}),e,this)})));return function(n,t,a){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){E.removeListener(a.addMember,this.onAddMemberListener)}},{key:"render",value:function(){var e=this.state,n=e.profiles,t=e.loading,a=e.isAdmin,r=e.admins;return Object(I.jsx)(G,{profiles:n,loading:t,isAdmin:a,adminUsernames:r.map((function(e){return e.username})),onRemoveAccountConfirm:this.onRemoveAccountConfirm,onSetAdminConfirm:this.onSetAdminConfirm,onRemoveAdminConfirm:this.onRemoveAdminConfirm})}}]),t}(l.PureComponent),V=Object(U.j)(Q)}}]);
//# sourceMappingURL=38.74355559.chunk.js.map