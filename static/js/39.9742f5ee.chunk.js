(this["webpackJsonpsoulike-git"]=this["webpackJsonpsoulike-git"]||[]).push([[39],{1108:function(y,C,a){y.exports={Members:"Style_Members__1A1TA",topArea:"Style_topArea__2Rqcb",cardContent:"Style_cardContent__3XM0M",titleWrapper:"Style_titleWrapper__30lrm",name:"Style_name__35BXt",isAdminTagWrapper:"Style_isAdminTagWrapper__h56El",isAdminTag:"Style_isAdminTag__3vPt2",avatarWrapper:"Style_avatarWrapper__31DG6",avatar:"Style_avatar__39V_0"}},1109:function(y,C,a){y.exports={modalContent:"Style_modalContent__2QoB9",usernameInput:"Style_usernameInput__2TSrf"}},1400:function(y,C,a){"use strict";a.r(C),a.d(C,"default",function(){return q});var f={};a.r(f),a.d(f,"addMember",function(){return Q});var M=a(0),n=a.n(M),N=a(1108),h=a.n(N),I=a(968),W=a(1428),D=a(180),O=a(965),R=a(969),T=a(970),g=a(957),E=a(102),U=a(49),j=a(276),V=a(961),$=a(960),x=a(504),L=a(1109),B=a.n(L);function z(p){const{onClick:l,showModal:e,username:t,loading:s,onModalCancelClick:o,onModalOkClick:d,onUsernameChange:m}=p;return n.a.createElement(n.a.Fragment,null,n.a.createElement(E.a,{type:"primary",onClick:l,loading:s,disabled:s},n.a.createElement(x.a,null),"\u6DFB\u52A0\u6210\u5458"),n.a.createElement(V.a,{destroyOnClose:!0,width:300,title:"\u6DFB\u52A0\u5C0F\u7EC4\u6210\u5458",visible:e,onOk:d,onCancel:o,confirmLoading:s},n.a.createElement("div",{className:B.a.modalContent},n.a.createElement($.a,{value:t,onChange:m,autoFocus:!0,placeholder:"\u65B0\u5C0F\u7EC4\u6210\u5458\u7684\u7528\u6237\u540D",className:B.a.usernameInput}))))}var J=n.a.memo(z),F=a(97),b=a(47),v=a(27),X=a(150),A=a(345),G=a(135),P=new G.EventEmitter;const Q="addMember";var S=(p,l,e)=>new Promise((t,s)=>{var o=i=>{try{m(e.next(i))}catch(r){s(r)}},d=i=>{try{m(e.throw(i))}catch(r){s(r)}},m=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,d);m((e=e.apply(p,l)).next())});class H extends M.PureComponent{constructor(l){super(l);this.setStatePromise=Object(F.promisify)(this.setState),this.initModal=()=>S(this,null,function*(){this.setStatePromise({username:""})}),this.onClick=()=>S(this,null,function*(){yield this.setStatePromise({showModal:!0}),yield this.initModal()}),this.onModalOkClick=()=>S(this,null,function*(){const{match:{params:{id:e}}}=this.props,{username:t}=this.state;X.b.Account.username(t)?(yield this.setStatePromise({loading:!0}),(yield v.d.addAccount({id:Number.parseInt(e)},{username:t}))!==null&&(A.a.success({message:`\u6DFB\u52A0\u6210\u5458 ${t} \u6210\u529F`}),yield this.setStatePromise({showModal:!1}),P.emit(f.addMember)),yield this.setStatePromise({loading:!1})):A.a.error({message:`\u7528\u6237 ${t} \u4E0D\u5B58\u5728`})}),this.onModalCancelClick=()=>S(this,null,function*(){yield this.setStatePromise({showModal:!1})}),this.onUsernameChange=e=>{this.setState({username:e.target.value})},this.state={showModal:!1,username:"",loading:!1}}render(){const{showModal:l,username:e,loading:t}=this.state;return n.a.createElement(J,{loading:t,showModal:l,username:e,onClick:this.onClick,onModalCancelClick:this.onModalCancelClick,onModalOkClick:this.onModalOkClick,onUsernameChange:this.onUsernameChange})}}var K=Object(b.j)(H),Y=a(214);function Z(p){const{profiles:l,loading:e,isAdmin:t,adminUsernames:s,onSetAdminConfirm:o,onRemoveAccountConfirm:d,onRemoveAdminConfirm:m}=p;return n.a.createElement("div",{className:h.a.Members},n.a.createElement("div",{className:h.a.topArea},n.a.createElement(I.a,{type:"info",showIcon:!0,message:"\u53EA\u6709\u5C0F\u7EC4\u6210\u5458\u53EF\u5C06\u4ED3\u5E93\u52A0\u5165\u5C0F\u7EC4"}),n.a.createElement("div",{className:h.a.addMemberButtonWrapper},t?n.a.createElement(K,null):null)),n.a.createElement(W.b,{loading:e,locale:{emptyText:n.a.createElement(D.a,{description:"\u6CA1\u6709\u6210\u5458"})},dataSource:[...l],renderItem:i=>{if(i!==null){const{nickname:r,username:c,avatar:_}=i;return n.a.createElement(O.a,{size:"small",key:c},n.a.createElement("div",{className:h.a.cardContent},n.a.createElement(j.a,{className:h.a.titleWrapper,to:U.Function.generatePersonalCenterRoute({username:c})},n.a.createElement("div",{className:h.a.avatarWrapper},n.a.createElement(Y.a,{avatar:_})),n.a.createElement("div",{className:h.a.name},r,"(",c,")"),n.a.createElement("div",{className:h.a.isAdminTagWrapper},s.includes(c)?n.a.createElement(R.a,{color:"blue",className:h.a.isAdminTag},"\u7BA1\u7406\u5458"):null)),t?n.a.createElement("div",{className:h.a.buttonWrapper},n.a.createElement(T.b,{size:-1},s.includes(c)?n.a.createElement(g.a,{title:`\u786E\u8BA4\u64A4\u9500\u6210\u5458 ${c} \u7684\u7BA1\u7406\u5458\u6743\u9650\uFF1F`,onConfirm:m(c),disabled:e},n.a.createElement(E.a,{loading:e,disabled:e},"\u64A4\u9500\u7BA1\u7406\u5458")):n.a.createElement(g.a,{title:`\u786E\u8BA4\u8BBE\u7F6E\u6210\u5458 ${c} \u4E3A\u7BA1\u7406\u5458\uFF1F`,onConfirm:o(c),disabled:e},n.a.createElement(E.a,{type:"primary",loading:e,disabled:e},"\u8BBE\u4E3A\u7BA1\u7406\u5458")),n.a.createElement(g.a,{title:`\u786E\u8BA4\u79FB\u9664\u6210\u5458 ${c}\uFF1F`,onConfirm:d(c),disabled:e},n.a.createElement(E.a,{type:"primary",danger:!0,loading:e,disabled:e},"\u79FB\u9664")))):null))}else return null}}))}var k=n.a.memo(Z),u=(p,l,e)=>new Promise((t,s)=>{var o=i=>{try{m(e.next(i))}catch(r){s(r)}},d=i=>{try{m(e.throw(i))}catch(r){s(r)}},m=i=>i.done?t(i.value):Promise.resolve(i.value).then(o,d);m((e=e.apply(p,l)).next())});class w extends M.PureComponent{constructor(l){super(l);this.setStatePromise=Object(F.promisify)(this.setState),this.onAddMemberListener=()=>u(this,null,function*(){return yield this.componentDidMount()}),this.removeAccount=e=>u(this,null,function*(){const{accounts:t,profiles:s,admins:o}=this.state,d=t.filter(({username:r})=>r!==e),m=s.filter(r=>r!==null&&r.username!==e),i=o.filter(({username:r})=>r!==e);yield this.setStatePromise({accounts:d,profiles:m,admins:i})}),this.addAdmin=e=>u(this,null,function*(){const{accounts:t,admins:s}=this.state,o=Array.from(s);for(const d of t)if(d.username===e){o.push(d);break}yield this.setStatePromise({admins:o})}),this.removeAdmin=e=>u(this,null,function*(){const{admins:t}=this.state,s=t.filter(({username:o})=>o!==e);yield this.setStatePromise({admins:s})}),this.loadIsAdmin=()=>u(this,null,function*(){const{match:{params:{id:e}}}=this.props,t=yield v.d.isAdmin({id:Number.parseInt(e)});if(t!==null){const{isAdmin:s}=t;yield this.setStatePromise({isAdmin:s})}}),this.loadAccounts=()=>u(this,null,function*(){const{match:{params:{id:e}}}=this.props,t=yield v.d.accounts({id:Number.parseInt(e)});t!==null&&(yield this.setStatePromise({accounts:t}))}),this.loadAdmins=()=>u(this,null,function*(){const{match:{params:{id:e}}}=this.props,t=yield v.d.admins({id:Number.parseInt(e)});t!==null&&(yield this.setStatePromise({admins:t}))}),this.loadProfiles=()=>u(this,null,function*(){const{accounts:e}=this.state,t=yield Promise.all(e.map(({username:s})=>v.g.get({username:s})));yield this.setStatePromise({profiles:t})}),this.onRemoveAccountConfirm=e=>{const{match:{params:{id:t}}}=this.props;return()=>u(this,null,function*(){yield this.setStatePromise({loading:!0}),(yield v.d.removeAccounts({id:Number.parseInt(t)},[e]))!==null&&(A.a.success({message:"\u79FB\u9664\u6210\u5458\u6210\u529F"}),yield this.removeAccount(e)),yield this.setStatePromise({loading:!1})})},this.onSetAdminConfirm=e=>{const{match:{params:{id:t}}}=this.props;return()=>u(this,null,function*(){yield this.setStatePromise({loading:!0}),(yield v.d.addAdmin({id:Number.parseInt(t)},{username:e}))!==null&&(A.a.success({message:`\u6210\u529F\u8BBE\u7F6E ${e} \u4E3A\u7BA1\u7406\u5458`}),yield this.addAdmin(e)),yield this.setStatePromise({loading:!1})})},this.onRemoveAdminConfirm=e=>{const{match:{params:{id:t}}}=this.props;return()=>u(this,null,function*(){yield this.setStatePromise({loading:!0}),(yield v.d.removeAdmins({id:Number.parseInt(t)},[e]))!==null&&(A.a.success({message:`\u6210\u529F\u64A4\u9500 ${e} \u7684\u7BA1\u7406\u5458\u8EAB\u4EFD`}),yield this.removeAdmin(e)),yield this.setStatePromise({loading:!1})})},this.state={accounts:[],admins:[],profiles:[],loading:!0,isAdmin:!1},P.on(f.addMember,this.onAddMemberListener)}componentDidMount(){return u(this,null,function*(){yield this.setStatePromise({loading:!0}),yield Promise.all([this.loadAccounts(),this.loadAdmins(),this.loadIsAdmin()]),yield this.loadProfiles(),yield this.setStatePromise({loading:!1})})}componentDidUpdate(l,e,t){return u(this,null,function*(){const{match:{params:{id:s}}}=this.props,{match:{params:{id:o}}}=l;s!==o&&(yield this.componentDidMount())})}componentWillUnmount(){P.removeListener(f.addMember,this.onAddMemberListener)}render(){const{profiles:l,loading:e,isAdmin:t,admins:s}=this.state;return n.a.createElement(k,{profiles:l,loading:e,isAdmin:t,adminUsernames:s.map(({username:o})=>o),onRemoveAccountConfirm:this.onRemoveAccountConfirm,onSetAdminConfirm:this.onSetAdminConfirm,onRemoveAdminConfirm:this.onRemoveAdminConfirm})}}var q=Object(b.j)(w)}}]);

//# sourceMappingURL=39.9742f5ee.chunk.js.map