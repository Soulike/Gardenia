"use strict";(self.webpackChunksoulike_git=self.webpackChunksoulike_git||[]).push([[3158],{91642:function(g,s,e){e.d(s,{Z:function(){return v}});var t=e(89526),n=e(82694);function c(){return t.createElement(n.Z,{avatar:""})}var v=t.memo(c)},95715:function(g,s,e){e.d(s,{Z:function(){return v}});var t=e(89526),n={SettingsTitle:"Style_SettingsTitle__2JkD4"};function c(p){const{children:E}=p;return t.createElement("h2",{className:n.SettingsTitle},E)}var v=t.memo(c)},83158:function(g,s,e){e.r(s),e.d(s,{default:function(){return W}});var t=e(89526),n={Avatar:"Style_Avatar__+m4G+",alertWrapper:"Style_alertWrapper__U7ag0",body:"Style_body__PST6B",avatarWrapper:"Style_avatarWrapper__aAeDi",avatar:"Style_avatar__+3h3o",fileInput:"Style_fileInput__zGzCV",buttonWrapper:"Style_buttonWrapper__CPr3+"},c=e(95715),v=e(91642),p=e(53546),E=e(5892),Z=e(43546),N=e(30592);function P(i){const{avatar:u,loading:a,fileInputRef:r,onAvatarClick:o,onAvatarInputChange:f,fileChanged:C,onUploadButtonClick:m,accept:l}=i;return t.createElement("div",{className:n.Avatar},t.createElement(c.Z,null,"\u5934\u50CF"),t.createElement("div",{className:n.alertWrapper},t.createElement(p.Z,{message:"\u70B9\u51FB\u56FE\u7247\u9009\u62E9\u65B0\u7684\u5934\u50CF\uFF0C\u56FE\u50CF\u6587\u4EF6\u5927\u5C0F 2M \u4EE5\u5185\u3002\u63A8\u8350\u4E0A\u4F20\u65B9\u5F62\u56FE\u50CF\uFF0C\u5426\u5219\u56FE\u50CF\u4F1A\u88AB\u62C9\u4F38\u3002",banner:!0,type:"info",showIcon:!0})),t.createElement("div",{className:n.body},t.createElement(E.Z,{spinning:a},t.createElement(Z.Z,{title:"\u70B9\u51FB\u66F4\u6362\u5934\u50CF"},t.createElement("div",{className:n.avatarWrapper,onClick:o},u?t.createElement("img",{src:u,alt:"avatar",className:n.avatar}):t.createElement(v.Z,null)))),t.createElement("input",{type:"file",accept:l,multiple:!1,className:n.fileInput,ref:r,onChange:f}),t.createElement("div",{className:n.buttonWrapper},t.createElement(N.Z,{type:"primary",block:!0,disabled:a||!C,loading:a,onClick:m},"\u4E0A\u4F20"))))}var B=t.memo(P),y=e(62371),d=e(24315),S=e(36393),D=e(85663),h=(i,u,a)=>new Promise((r,o)=>{var f=l=>{try{m(a.next(l))}catch(A){o(A)}},C=l=>{try{m(a.throw(l))}catch(A){o(A)}},m=l=>l.done?r(l.value):Promise.resolve(l.value).then(f,C);m((a=a.apply(i,u)).next())});const F=class extends t.PureComponent{constructor(i){super(i);this.fileInputRef=t.createRef(),this.setStatePromise=(0,D.promisify)(this.setState),this.loadAvatar=()=>h(this,null,function*(){const u=yield y.NZ.get();if(u!==null){const{avatar:a}=u;yield this.setStatePromise({avatar:a})}else{const{history:a}=this.props;return a.replace(S.yt[S.DV.NOT_FOUND])}}),this.onAvatarClick=()=>{const u=this.fileInputRef.current;u!==null&&u.click()},this.onAvatarInputChange=u=>{const{files:a}=u.target;if(a!==null)if(a.length===1){const r=a[0],{type:o,size:f}=r;f<=2*1024*1024&&F.ALLOWED_MIME_TYPE.includes(o)?this.setState({file:r,avatar:URL.createObjectURL(r)}):d.Z.error({message:"\u53EA\u80FD\u4E0A\u4F20 2M \u4EE5\u5185\u7684 JPG \u6216 PNG \u56FE\u50CF\u6587\u4EF6\u4F5C\u4E3A\u5934\u50CF"})}else d.Z.error({message:"\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\u4F5C\u4E3A\u5934\u50CF"})},this.onUploadButtonClick=()=>h(this,null,function*(){const{file:u}=this.state;u===null?d.Z.warn({message:"\u8BF7\u5148\u9009\u62E9\u5934\u50CF"}):(this.setState({loading:!0}),(yield y.NZ.uploadAvatar(u))!==null&&(d.Z.success({message:"\u4E0A\u4F20\u5934\u50CF\u6210\u529F"}),setTimeout(()=>{window.location.reload()},1e3)),this.setState({loading:!1}))}),this.state={avatar:"",loading:!1,file:null}}componentDidMount(){return h(this,null,function*(){yield this.setStatePromise({loading:!0}),yield this.loadAvatar(),yield this.setStatePromise({loading:!1})})}render(){const{avatar:i,loading:u,file:a}=this.state;return t.createElement(B,{onAvatarInputChange:this.onAvatarInputChange,onAvatarClick:this.onAvatarClick,fileInputRef:this.fileInputRef,avatar:i,loading:u,fileChanged:a!==null,onUploadButtonClick:this.onUploadButtonClick,accept:F.ALLOWED_MIME_TYPE.join(",")})}};let I=F;I.ALLOWED_MIME_TYPE=["image/jpeg","image/png"];var W=I}}]);

//# sourceMappingURL=3158.38aa3559.chunk.js.map