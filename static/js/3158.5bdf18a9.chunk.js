"use strict";(self.webpackChunksoulike_git=self.webpackChunksoulike_git||[]).push([[3158],{91642:function(g,s,a){a.d(s,{Z:function(){return v}});var t=a(89526),u=a(82694);function c(){return t.createElement(u.Z,{avatar:""})}var v=t.memo(c)},95715:function(g,s,a){a.d(s,{Z:function(){return v}});var t=a(89526),u={SettingsTitle:"Style_SettingsTitle__2JkD4"};function c(p){const{children:E}=p;return t.createElement("h2",{className:u.SettingsTitle},E)}var v=t.memo(c)},83158:function(g,s,a){a.r(s),a.d(s,{default:function(){return D}});var t=a(89526),u={Avatar:"Style_Avatar__+m4G+",alertWrapper:"Style_alertWrapper__U7ag0",body:"Style_body__PST6B",avatarWrapper:"Style_avatarWrapper__aAeDi",avatar:"Style_avatar__+3h3o",fileInput:"Style_fileInput__zGzCV",buttonWrapper:"Style_buttonWrapper__CPr3+"},c=a(95715),v=a(91642),p=a(53546),E=a(5892),P=a(34267),Z=a(30592);function N(r){const{avatar:n,loading:e,fileInputRef:i,onAvatarClick:o,onAvatarInputChange:m,fileChanged:C,onUploadButtonClick:f,accept:l}=r;return t.createElement("div",{className:u.Avatar},t.createElement(c.Z,null,"\u5934\u50CF"),t.createElement("div",{className:u.alertWrapper},t.createElement(p.Z,{message:"\u70B9\u51FB\u56FE\u7247\u9009\u62E9\u65B0\u7684\u5934\u50CF\uFF0C\u56FE\u50CF\u6587\u4EF6\u5927\u5C0F 2M \u4EE5\u5185\u3002\u63A8\u8350\u4E0A\u4F20\u65B9\u5F62\u56FE\u50CF\uFF0C\u5426\u5219\u56FE\u50CF\u4F1A\u88AB\u62C9\u4F38\u3002",banner:!0,type:"info",showIcon:!0})),t.createElement("div",{className:u.body},t.createElement(E.Z,{spinning:e},t.createElement(P.Z,{title:"\u70B9\u51FB\u66F4\u6362\u5934\u50CF"},t.createElement("div",{className:u.avatarWrapper,onClick:o},n?t.createElement("img",{src:n,alt:"avatar",className:u.avatar}):t.createElement(v.Z,null)))),t.createElement("input",{type:"file",accept:l,multiple:!1,className:u.fileInput,ref:i,onChange:m}),t.createElement("div",{className:u.buttonWrapper},t.createElement(Z.Z,{type:"primary",block:!0,disabled:e||!C,loading:e,onClick:f},"\u4E0A\u4F20"))))}var B=t.memo(N),y=a(62371),d=a(24315),S=a(36393),h=(r,n,e)=>new Promise((i,o)=>{var m=l=>{try{f(e.next(l))}catch(A){o(A)}},C=l=>{try{f(e.throw(l))}catch(A){o(A)}},f=l=>l.done?i(l.value):Promise.resolve(l.value).then(m,C);f((e=e.apply(r,n)).next())});const F=class extends t.PureComponent{constructor(r){super(r);this.fileInputRef=t.createRef(),this.setStatePromise=n=>new Promise(e=>{this.setState(n,()=>{e()})}),this.loadAvatar=()=>h(this,null,function*(){const n=yield y.NZ.get();if(n!==null){const{avatar:e}=n;yield this.setStatePromise({avatar:e})}else{const{history:e}=this.props;return e.replace(S.yt[S.DV.NOT_FOUND])}}),this.onAvatarClick=()=>{const n=this.fileInputRef.current;n!==null&&n.click()},this.onAvatarInputChange=n=>{const{files:e}=n.target;if(e!==null)if(e.length===1){const i=e[0],{type:o,size:m}=i;m<=2*1024*1024&&F.ALLOWED_MIME_TYPE.includes(o)?this.setState({file:i,avatar:URL.createObjectURL(i)}):d.Z.error({message:"\u53EA\u80FD\u4E0A\u4F20 2M \u4EE5\u5185\u7684 JPG \u6216 PNG \u56FE\u50CF\u6587\u4EF6\u4F5C\u4E3A\u5934\u50CF"})}else d.Z.error({message:"\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\u4F5C\u4E3A\u5934\u50CF"})},this.onUploadButtonClick=()=>h(this,null,function*(){const{file:n}=this.state;n===null?d.Z.warn({message:"\u8BF7\u5148\u9009\u62E9\u5934\u50CF"}):(this.setState({loading:!0}),(yield y.NZ.uploadAvatar(n))!==null&&(d.Z.success({message:"\u4E0A\u4F20\u5934\u50CF\u6210\u529F"}),setTimeout(()=>{window.location.reload()},1e3)),this.setState({loading:!1}))}),this.state={avatar:"",loading:!1,file:null}}componentDidMount(){return h(this,null,function*(){yield this.setStatePromise({loading:!0}),yield this.loadAvatar(),yield this.setStatePromise({loading:!1})})}render(){const{avatar:r,loading:n,file:e}=this.state;return t.createElement(B,{onAvatarInputChange:this.onAvatarInputChange,onAvatarClick:this.onAvatarClick,fileInputRef:this.fileInputRef,avatar:r,loading:n,fileChanged:e!==null,onUploadButtonClick:this.onUploadButtonClick,accept:F.ALLOWED_MIME_TYPE.join(",")})}};let I=F;I.ALLOWED_MIME_TYPE=["image/jpeg","image/png"];var D=I}}]);

//# sourceMappingURL=3158.5bdf18a9.chunk.js.map